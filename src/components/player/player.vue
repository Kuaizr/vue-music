<!--  -->
<template>
   <div class="player">
       <div class="normal-player" v-show="this.fullScreen">
           <div class="background">
               <img :src="imgurl" class="imgback">
           </div>
           <div class="top">
               <div class="back">
                   <span @click="backtomini()"><svg t="1620470565653" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1620" width="48" height="48"><path d="M511.31 669.4a61.19 61.19 0 0 1-43.25-17.79l-237.12-237.2a35 35 0 0 1 49.55-49.55l230.89 230.9 230.9-230.89a35 35 0 1 1 49.55 49.55L554.7 651.54a61.41 61.41 0 0 1-43.39 17.86z" fill="#db7e08" p-id="1621"></path></svg></span>
               </div>
                   <span class="songname">{{this.currentSong.name}}</span> <br>
                   <span class="songinfo">{{joinSingers(this.currentSong.ar)}}</span>
           </div>
           <div class="middle">
               <div class="cd-wrapper">
                   <div class="cd">
                       <img :src="imgurl" class="cdimg">
                   </div>
               </div>
           </div>
           <div class="words"></div>
           <div class="songbar">
               <span class="time-l">{{format(currentTime)}}</span>
               <ProgressBar @percentChange="onProgressBarChange" :percent="percent"></ProgressBar>
               <span class="time-right">{{format(totalTime)}}</span>
           </div>
           <div class="bottom">
               <div @click="_setMode()" class="playtype">
                   <span v-show="this.mode == 2"><svg t="1620468758197" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2416" width="32" height="32"><path d="M610.009709 480.126059c-17.231453 0-30.379914-12.43624-30.607088-28.928866l-1.611707-125.007085c-0.12075-7.736195 2.752694-15.001669 8.085142-20.413935 9.8176-9.991562 27.704992-12.140505 40.894386-4.780887l102.685707 61.361533c10.434653 5.842055 16.693194 15.069207 16.814967 25.128307 0.12075 9.441023-5.278213 18.10331-14.800078 23.757077l-103.048981 63.712067C622.659821 478.380298 616.361371 480.126059 610.009709 480.126059zM609.216647 323.948043c-1.812275 0-3.210112 0.577145-3.746324 1.127683l1.436722 125.759215c0.026606 1.759063 2.189875 3.6399 7.266497 0.604774l103.047957-63.712067c0.148379-0.094144 0.295735-0.173962 0.429789-0.268106-0.497327-0.38988-1.140986-0.832971-1.974981-1.302669l-102.658078-61.34823C611.783099 324.136332 610.237907 323.948043 609.216647 323.948043z" p-id="2417" fill="#db7e08"></path><path d="M496.968144 918.253584c-246.320035 0-446.708971-200.38996-446.708971-446.696692 0-246.320035 200.388936-446.708971 446.708971-446.708971 246.321058 0 446.708971 200.388936 446.708971 446.708971C943.678138 717.863624 743.289202 918.253584 496.968144 918.253584zM496.968144 79.856769c-215.981053 0-391.700123 175.718047-391.700123 391.700123 0 215.982076 175.718047 391.68682 391.700123 391.68682s391.700123-175.704744 391.700123-391.68682C888.66929 255.57584 712.95022 79.856769 496.968144 79.856769z" p-id="2418" fill="#db7e08"></path><path d="M829.066821 485.310128c-7.602142 0-13.751189-6.151094-13.751189-13.752212 0-143.123698-96.306416-269.405823-234.192833-307.104423-7.333012-2.000564-11.644201-9.561773-9.643638-16.894785 2.01489-7.333012 9.656941-11.589966 16.895809-9.642614 149.811004 40.961924 254.444063 178.149423 254.444063 333.641823C842.818009 479.159034 836.667939 485.310128 829.066821 485.310128z" p-id="2419" fill="#db7e08"></path><path d="M515.515568 153.708777c-0.255827 0-0.51063 0-0.765433-0.026606-5.89629-0.322341-11.831466-0.484024-17.781992-0.484024-7.601118 0-13.752212-6.151094-13.752212-13.752212s6.151094-13.752212 13.752212-13.752212c6.459109 0 12.879332 0.188288 19.286252 0.537236 7.587815 0.403183 13.389962 6.888897 12.973476 14.477736C528.839015 148.027381 522.767739 153.708777 515.515568 153.708777z" p-id="2420" fill="#db7e08"></path><path d="M276.340257 638.19719c-25.489534 0-42.451858-6.018064-42.921555-6.192026-7.118118-2.659573-10.730389-10.583033-8.085142-17.701151 2.659573-7.118118 10.609639-10.663874 17.700127-8.084119 4.431939 1.651616 111.093191 38.22151 184.327122-112.154359 65.297169-134.005017 162.30148-120.010281 166.371168-119.365598 7.493671 1.209548 12.597923 8.272407 11.389398 15.767102-1.209548 7.467065-8.192589 12.516058-15.687284 11.401678-3.477194-0.496304-81.493036-10.381441-137.334855 104.244202C397.505851 618.158808 322.780963 638.19719 276.340257 638.19719z" p-id="2421" fill="#db7e08"></path><path d="M609.216647 688.653349 609.216647 688.653349c-8.997931 0-17.498536-3.397377-23.340591-9.333576-5.332449-5.412266-8.206916-12.67774-8.085142-20.453844l1.611707-124.95285c0.228197-16.504906 13.375635-28.941146 30.607088-28.941146 6.351662 0 12.650111 1.74576 18.210757 5.050016l103.45114 63.954591c9.320273 5.531993 14.72026 14.19428 14.59951 23.636327-0.12075 10.0591-6.379291 19.286252-17.137309 25.315572l-102.013395 60.972677C621.423667 687.082574 615.354438 688.653349 609.216647 688.653349zM610.009709 532.475334c-2.042519 0-3.090385 0.605797-3.102664 1.801019l-1.611707 124.979456c1.101077 2.054799 3.666506 3.236718 8.071839 0.831948l101.987812-60.95835c0.99363-0.564865 1.732457-1.074472 2.281973-1.50426-0.065492-0.039909-0.148379-0.080841-0.213871-0.134053l-103.452163-63.954591C612.51988 532.676925 610.989013 532.475334 610.009709 532.475334z" p-id="2422" fill="#db7e08"></path><path d="M575.265394 611.713003c-35.991726 0-113.591081-13.390985-148.630109-122.509195-18.49319-57.58758-46.883797-95.111195-84.380806-111.522979-49.181119-21.515013-97.744161 0.537236-98.227162 0.778736-6.92983 3.210112-15.068184 0.201591-18.278295-6.674003-3.196809-6.889921-0.201591-15.069207 6.675026-18.278295 2.443655-1.128707 60.435441-27.451212 120.856555-1.034563 45.044916 19.715017 78.538751 62.892399 99.543134 128.323621 38.758746 120.722502 132.044362 103.343693 135.992277 102.537328 7.440459-1.489934 14.69263 3.317559 16.211217 10.759041 1.503237 7.439436-3.317559 14.70491-10.759041 16.20917C593.973478 610.356099 586.735633 611.713003 575.265394 611.713003z" p-id="2423" fill="#db7e08"></path></svg></span>
                   <span v-show="this.mode == 0"><svg t="1620468788972" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2887" width="32" height="32"><path d="M343.844697 622.805642c-6.580882 0-13.18837-2.64627-19.097964-7.627724l-93.915973-76.538187c-9.736758-8.232498-14.369266-20.467147-12.274558-32.098046 1.826602-10.206456 8.823969-18.425651 18.708084-21.998013l117.566626-42.425252c11.510148-4.136204 24.267706-0.537236 32.258705 9.025561 6.580882 7.869225 9.414417 18.721387 7.574512 29.021987l-24.388457 117.123534C367.50763 612.640118 357.112885 622.805642 343.844697 622.805642zM364.741633 467.850477l-118.130468 42.559305c-0.859577 0.309038-0.899486 0.523933-0.980327 0.99363-0.295735 1.611707 0.563842 4.203742 2.76702 6.070252l93.90267 76.524884c0.134053 0.119727 0.268106 0.228197 0.388856 0.321318 0.214894-0.591471 0.429789-1.342578 0.591471-2.282996l24.388457-117.095905c0.416486-2.430352-0.618077-4.888334-1.664919-6.137791C365.426225 468.106304 364.929922 467.850477 364.741633 467.850477z" p-id="2888" fill="#db7e08"></path><path d="M496.113683 918.253584c-246.320035 0-446.709995-200.38996-446.709995-446.696692 0-246.320035 200.388936-446.708971 446.709995-446.708971 246.320035 0 446.708971 200.388936 446.708971 446.708971C942.823678 717.863624 742.433718 918.253584 496.113683 918.253584zM496.113683 79.856769c-215.982076 0-391.700123 175.718047-391.700123 391.700123 0 215.982076 175.718047 391.68682 391.700123 391.68682 215.981053 0 391.6991-175.704744 391.6991-391.68682C887.813806 255.57584 712.095759 79.856769 496.113683 79.856769z" p-id="2889" fill="#db7e08"></path><path d="M496.113683 687.874613c-7.602142 0-13.752212-6.151094-13.752212-13.752212s6.151094-13.751189 13.752212-13.751189c104.122429 0 188.825576-84.703147 188.825576-188.813297 0-104.122429-84.703147-188.825576-188.825576-188.825576-104.123452 0-188.8266 84.703147-188.8266 188.825576 0 7.602142-6.151094 13.752212-13.752212 13.752212s-13.752212-6.151094-13.752212-13.752212c0-119.284757 97.045243-216.33 216.331024-216.33 119.284757 0 216.33 97.045243 216.33 216.33C712.444706 590.82937 615.399463 687.874613 496.113683 687.874613z" p-id="2890" fill="#db7e08"></path><path d="M828.21236 485.310128c-7.602142 0-13.752212-6.151094-13.752212-13.752212 0-143.123698-96.306416-269.405823-234.192833-307.104423-7.333012-2.000564-11.644201-9.561773-9.642614-16.894785 2.01489-7.333012 9.656941-11.589966 16.895809-9.642614 149.811004 40.961924 254.444063 178.149423 254.444063 333.641823C841.963549 479.159034 835.812455 485.310128 828.21236 485.310128z" p-id="2891" fill="#db7e08"></path><path d="M514.660084 153.708777c-0.254803 0-0.509606 0-0.765433-0.026606-5.89629-0.322341-11.831466-0.484024-17.780969-0.484024-7.602142 0-13.752212-6.151094-13.752212-13.752212s6.151094-13.752212 13.752212-13.752212c6.459109 0 12.879332 0.188288 19.286252 0.537236 7.586792 0.403183 13.388938 6.888897 12.973476 14.477736C527.983531 148.027381 521.913279 153.708777 514.660084 153.708777z" p-id="2892" fill="#db7e08"></path></svg></span>
                   <span v-show="this.mode == 1"><svg t="1620468917900" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2714" width="32" height="32"><path d="M773.597867 203.776l-0.273067 0.443733a33.621333 33.621333 0 0 0-20.343467-6.485333c-18.978133 0.785067-33.723733 16.725333-32.9728 35.771733a33.826133 33.826133 0 0 0 15.633067 26.794667l-0.1024 0.170667a375.227733 375.227733 0 0 1 166.2976 311.876266c0 207.018667-168.448 375.466667-375.466667 375.466667-27.818667 0-27.818667 0-54.340266-2.901333-90.453333-9.898667-152.610133-58.9824-155.5456-61.201067a375.330133 375.330133 0 0 1-165.5808-311.364267c0-201.4208 159.5392-365.841067 358.843733-374.647466l-41.984 40.823466 0.8192 0.853334a33.860267 33.860267 0 0 0-15.2576 29.218133c0.750933 18.978133 16.725333 33.757867 35.669333 33.041067a33.792 33.792 0 0 0 26.0096-14.472534l0.3072 0.341334 128.648534-124.996267L515.6864 34.0992l-0.4096 0.4096a33.6896 33.6896 0 0 0-26.3168-11.400533c-18.944 0.750933-33.6896 16.725333-32.9728 35.703466a33.8944 33.8944 0 0 0 13.038933 25.156267l45.226667 45.2608C275.182933 135.714133 82.602667 331.741867 82.602667 572.347733c0 147.626667 73.1136 285.149867 193.194666 366.114134 3.072 2.56 77.550933 62.190933 188.757334 74.308266 29.422933 3.208533 31.1296 3.310933 61.781333 3.310934 244.667733 0 443.733333-199.0656 443.733333-443.733334A443.392 443.392 0 0 0 773.597867 203.776" p-id="2715" fill="#db7e08"></path><path d="M542.071467 400.827733a33.28 33.28 0 0 0-17.134934 6.075734l-0.170666-0.3072-106.8032 69.700266 0.170666 0.273067a33.9968 33.9968 0 0 0-15.837866 29.696c0.750933 18.944 16.725333 33.723733 35.669333 32.9728a33.109333 33.109333 0 0 0 17.1008-6.0416l0.2048 0.273067 53.998933-35.259734v249.856h0.034134c0 0.477867-0.238933 0.887467-0.2048 1.365334a34.2016 34.2016 0 1 0 68.4032-1.365334h0.034133v-0.170666c0-0.4096 0.2048-0.750933 0.2048-1.160534 0-0.273067-0.170667-0.477867-0.2048-0.785066V435.2c0-0.477867 0.2048-0.887467 0.2048-1.3312a34.4064 34.4064 0 0 0-35.669333-33.041067" p-id="2716" fill="#db7e08"></path></svg></span>
               </div>
               <div class="last" @click="lastsong()">
                   <span><svg t="1620468867397" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2248" width="32" height="32"><path d="M496.452397 918.259724c-246.310825 0-446.716134-200.392006-446.716134-446.702831 0-246.323105 200.405309-446.716134 446.716134-446.716134 246.309802 0 446.701808 200.39303 446.701808 446.716134C943.154205 717.867718 742.762199 918.259724 496.452397 918.259724zM496.452397 79.850629c-215.985146 0-391.706263 175.721117-391.706263 391.706263 0 215.985146 175.721117 391.691937 391.706263 391.691937 215.984123 0 391.691937-175.706791 391.691937-391.691937C888.144334 255.57277 712.43652 79.850629 496.452397 79.850629z" p-id="2249" fill="#db7e08"></path><path d="M828.555168 485.310128c-7.587815 0-13.752212-6.151094-13.752212-13.752212 0-143.125745-96.30744-269.409916-234.195903-307.108516-7.318686-2.001587-11.644201-9.562796-9.643638-16.894785 2.001587-7.319709 9.562796-11.590989 16.895809-9.642614 149.814074 40.961924 254.448156 178.151469 254.448156 333.646939C842.306356 479.159034 836.156286 485.310128 828.555168 485.310128z" p-id="2250" fill="#db7e08"></path><path d="M514.998799 153.703661c-0.25378 0-0.509606 0-0.765433-0.026606-5.895267-0.322341-11.818163-0.483001-17.780969-0.483001-7.587815 0-13.752212-6.151094-13.752212-13.752212s6.164397-13.752212 13.752212-13.752212c6.460132 0 12.893658 0.188288 19.286252 0.537236 7.587815 0.403183 13.403265 6.889921 12.986779 14.477736C528.321222 148.023288 522.25097 153.703661 514.998799 153.703661z" p-id="2251" fill="#db7e08"></path><path d="M422.774351 597.062328 422.774351 597.062328c-7.333012 0-14.854313-2.109034-21.757536-6.083555l-145.516188-89.633437c-11.818163-6.809079-18.802228-17.445324-18.802228-28.995381-0.013303-12.033058 7.453762-23.260773 20.481474-30.795377l142.750191-89.162716c7.306406-4.230348 19.675108-6.339382 27.102265-6.339382 20.561291 0 40.277332 15.162328 40.277332 36.07359l0 178.850387c0 10.313903-8.43409 19.635199-15.069207 26.216081C445.846836 593.557504 432.281889 597.062328 422.774351 597.062328zM427.031305 373.556904c-2.605338 0-7.823176 0.831948-10.549264 2.403746l-143.93825 89.162716c-5.318122 3.089361-7.755638 6.01704-7.742335 7.198959 0 0.927115 1.121544 3.115967 5.083785 5.398964l145.355529 89.633437c2.390443 1.369184 5.089925 2.202155 7.601118 2.202155l0 0c1.557472 0 8.494465-0.322341 10.039657-1.866511 1.786693-1.772366 6.92369-4.63353 6.92369-6.714935L439.805236 382.125047C439.803189 375.033535 430.670182 373.556904 427.031305 373.556904z" p-id="2252" fill="#db7e08"></path><path d="M632.205221 597.062328 632.205221 597.062328c-6.903224 0-13.954827-2.054799-20.952194-6.083555L469.537398 501.251192c-12.019755-6.916527-19.191084-17.795295-19.205411-29.546943-0.013303-11.845793 7.252171-22.832008 19.903306-30.150694l145.208173-89.122807c27.786857-16.089443 58.152445 0.618077 58.152445 29.694299l0 178.850387c0 10.072403-7.65433 18.828834-13.080923 25.288966C654.686235 593.22186 641.538797 597.062328 632.205221 597.062328zM636.918569 373.556904c-1.14201 0-6.01704 0.309038-9.642614 2.403746l-141.595902 89.122807c-4.995781 2.901073-7.246031 5.493108-7.246031 6.607488 0 1.047866 1.282203 3.518127 5.634324 6.030343l141.553946 89.727581c3.143597 1.785669 5.520737 2.109034 6.64842 2.109034 0 0-0.013303 0 0 0 1.50426 0 6.795776-0.497327 7.197936-0.954745 1.155313-1.38351 6.621814-4.243651 6.621814-7.627724L646.090463 382.125047C646.091486 378.217041 640.545166 373.556904 636.918569 373.556904z" p-id="2253" fill="#db7e08"></path></svg></span>
               </div>
               <div @click.stop="_setkey()" class="key">
                   <span v-show="!this.playing"><svg t="1620467741706" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1581" width="32" height="32"><path d="M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0z m0 981.333333C253.866667 981.333333 42.666667 770.133333 42.666667 512S253.866667 42.666667 512 42.666667s469.333333 211.2 469.333333 469.333333-211.2 469.333333-469.333333 469.333333z" p-id="1582" fill="#db7e08"></path><path d="M672 441.6l-170.666667-113.066667c-57.6-38.4-106.666667-12.8-106.666666 57.6v256c0 70.4 46.933333 96 106.666666 57.6l170.666667-113.066666c57.6-42.666667 57.6-106.666667 0-145.066667z" p-id="1583" fill="#db7e08"></path></svg></span>
                   <span v-show="this.playing"><svg t="1620467776685" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1923" width="32" height="32"><path d="M512 1024C228.266667 1024 0 795.733333 0 512S228.266667 0 512 0s512 228.266667 512 512-228.266667 512-512 512z m0-42.666667c260.266667 0 469.333333-209.066667 469.333333-469.333333S772.266667 42.666667 512 42.666667 42.666667 251.733333 42.666667 512s209.066667 469.333333 469.333333 469.333333z m-106.666667-682.666666c12.8 0 21.333333 8.533333 21.333334 21.333333v384c0 12.8-8.533333 21.333333-21.333334 21.333333s-21.333333-8.533333-21.333333-21.333333V320c0-12.8 8.533333-21.333333 21.333333-21.333333z m213.333334 0c12.8 0 21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333s-21.333333-8.533333-21.333334-21.333333V320c0-12.8 8.533333-21.333333 21.333334-21.333333z" p-id="1924" fill="#db7e08"></path></svg></span>
               </div>
               <div class="next" @click="nextsong()">
                   <span><svg t="1620468879784" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2459" width="32" height="32"><path d="M496.457514 918.259724c-246.323105 0-446.716134-200.392006-446.716134-446.702831 0-246.323105 200.39303-446.716134 446.716134-446.716134 246.309802 0 446.701808 200.39303 446.701808 446.716134C943.160345 717.867718 742.768339 918.259724 496.457514 918.259724zM496.457514 79.850629c-215.984123 0-391.706263 175.721117-391.706263 391.706263 0 215.985146 175.721117 391.691937 391.706263 391.691937S888.150474 687.542038 888.150474 471.556892C888.150474 255.57277 712.44266 79.850629 496.457514 79.850629z" p-id="2460" fill="#db7e08"></path><path d="M828.560284 485.310128c-7.602142 0-13.752212-6.151094-13.752212-13.752212 0-143.125745-96.30744-269.409916-234.195903-307.108516-7.318686-2.001587-11.644201-9.562796-9.643638-16.894785 2.001587-7.333012 9.643638-11.56336 16.895809-9.642614 149.814074 40.961924 254.449179 178.151469 254.449179 333.646939C842.313519 479.159034 836.162426 485.310128 828.560284 485.310128z" p-id="2461" fill="#db7e08"></path><path d="M515.004939 153.703661c-0.254803 0-0.51063 0-0.765433-0.026606-5.89629-0.322341-11.819187-0.483001-17.781992-0.483001-7.587815 0-13.752212-6.151094-13.752212-13.752212s6.164397-13.752212 13.752212-13.752212c6.460132 0 12.893658 0.188288 19.286252 0.537236 7.587815 0.403183 13.403265 6.889921 12.986779 14.477736C528.327362 148.023288 522.25711 153.703661 515.004939 153.703661z" p-id="2462" fill="#db7e08"></path><path d="M568.068482 597.062328c-20.992103 0-32.072463-15.512299-32.072463-36.086893L535.996019 382.125047c0-20.561291 11.43033-36.07359 32.877805-36.07359 7.789407 0 13.189394 2.109034 20.063965 6.083555l143.676283 89.633437c12.893658 7.453762 19.891026 18.815531 19.891026 30.957059-0.014326 11.416004-7.17133 21.931498-19.151176 28.821419l-145.019885 89.284489C581.174987 594.954317 575.722812 597.062328 568.068482 597.062328zM568.873824 373.556904c-2.37714 0-5.372358 0.618077-5.372358 8.568143l0 178.850387c0 7.735172 1.772366 8.582469 4.567016 8.582469 2.834558 0 3.41068-0.832971 6.123464-2.40477l146.066727-89.284489c3.988848-2.296299 4.740978-4.324492 4.740978-5.157463 0-1.249457-2.228761-4.351098-7.399527-7.333012l-142.628418-89.633437C572.606845 374.389876 571.828109 373.556904 568.873824 373.556904z" p-id="2463" fill="#db7e08"></path><path d="M358.636588 597.062328c-19.527752 0-28.928866-15.176654-28.928866-36.086893L329.707722 382.125047c0-20.911262 9.549493-36.07359 29.277814-36.07359 7.184633 0 12.255115 2.109034 19.145036 6.083555l141.507898 89.687672c12.435217 7.184633 19.21769 18.305925 19.205411 30.258141 0 11.643178-7.359618 22.37459-19.662829 29.465079l-140.943033 89.190345C370.932636 594.954317 365.754706 597.062328 358.636588 597.062328zM358.986559 373.556904c-4.337795 0-1.772366 2.874467-1.772366 8.568143l0 178.850387c0 8.582469-0.107447 8.582469 1.423419 8.582469 1.598404 0 1.860371-0.416486 5.311982-2.40477l141.991921-89.190345c4.511757-2.618641 5.412266-4.91494 5.412266-5.895267 0-1.181919-2.042519-3.935636-6.809079-6.688329l-140.460032-89.687672C361.799628 374.389876 361.350396 373.556904 358.986559 373.556904z" p-id="2464" fill="#db7e08"></path></svg></span>
               </div>
               <div class="love">
                   <span><svg t="1620468957018" class="icon" viewBox="0 0 1426 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3544" width="32" height="32"><path d="M985.6 1022.976c-14.848 0-31.744-4.096-47.104-12.288L716.288 899.584l-223.744 111.104c-14.336 7.68-30.208 11.776-47.104 11.776-21.504 0-42.496-6.656-59.392-19.456-31.232-23.552-47.104-64-39.936-101.376l45.568-237.056-175.616-163.328c-27.136-27.648-37.376-67.072-27.136-104.448l0.512-1.024c12.8-38.4 44.544-65.024 82.944-70.144l243.712-44.544L625.152 58.88C642.56 23.552 678.4 1.024 716.288 1.024c39.424 0 76.288 23.552 91.648 58.368l109.056 221.696 243.712 42.496c38.4 5.632 70.656 33.28 81.408 71.168 12.288 36.864 2.048 77.312-25.6 104.96l-0.512 0.512-174.592 164.864 44.032 237.568c7.168 37.888-8.192 76.288-39.424 100.352-17.92 12.8-38.912 19.968-60.416 19.968z" fill="#db7e08" p-id="3545"></path></svg></span>
               </div>
           </div>
       </div>
       <div @click="backtonormal()" class="mini-player" v-show="!this.fullScreen">
           <div class="mini-icon">
               <img :src="imgurl" alt="" class="miniimg">
           </div>
           <div class="mini-info">
               <span class="songname">{{this.currentSong.name}}</span> <br>
                   <span class="songinfo">{{joinSingers(this.currentSong.ar)}}</span>
           </div>
           <div @click.stop="_setkey()" class="mini-key">
               <span v-show="!this.playing"><svg t="1620467741706" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1581" width="32" height="32"><path d="M512 0C230.4 0 0 230.4 0 512s230.4 512 512 512 512-230.4 512-512S793.6 0 512 0z m0 981.333333C253.866667 981.333333 42.666667 770.133333 42.666667 512S253.866667 42.666667 512 42.666667s469.333333 211.2 469.333333 469.333333-211.2 469.333333-469.333333 469.333333z" p-id="1582" fill="#db7e08"></path><path d="M672 441.6l-170.666667-113.066667c-57.6-38.4-106.666667-12.8-106.666666 57.6v256c0 70.4 46.933333 96 106.666666 57.6l170.666667-113.066666c57.6-42.666667 57.6-106.666667 0-145.066667z" p-id="1583" fill="#db7e08"></path></svg></span>
               <span v-show="this.playing"><svg t="1620467776685" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1923" width="32" height="32"><path d="M512 1024C228.266667 1024 0 795.733333 0 512S228.266667 0 512 0s512 228.266667 512 512-228.266667 512-512 512z m0-42.666667c260.266667 0 469.333333-209.066667 469.333333-469.333333S772.266667 42.666667 512 42.666667 42.666667 251.733333 42.666667 512s209.066667 469.333333 469.333333 469.333333z m-106.666667-682.666666c12.8 0 21.333333 8.533333 21.333334 21.333333v384c0 12.8-8.533333 21.333333-21.333334 21.333333s-21.333333-8.533333-21.333333-21.333333V320c0-12.8 8.533333-21.333333 21.333333-21.333333z m213.333334 0c12.8 0 21.333333 8.533333 21.333333 21.333333v384c0 12.8-8.533333 21.333333-21.333333 21.333333s-21.333333-8.533333-21.333334-21.333333V320c0-12.8 8.533333-21.333333 21.333334-21.333333z" p-id="1924" fill="#db7e08"></path></svg></span>
           </div>
           <div class="mini-list">
               <span><svg t="1620468017487" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2364" width="32" height="32"><path d="M128 432c0-35.2 25.104-49.888 55.776-32.624l144.432 81.248c30.672 17.264 30.672 45.504 0 62.752l-144.432 81.248C153.104 641.888 128 627.2 128 592V432zM896 688a32 32 0 0 1-32 32H480a32 32 0 1 1 0-64h384a32 32 0 0 1 32 32zM896 160a32 32 0 0 1-32 32H160a32 32 0 1 1 0-64h704a32 32 0 0 1 32 32zM896 864a32 32 0 0 1-32 32H160a32 32 0 1 1 0-64h704a32 32 0 0 1 32 32zM896 336a32 32 0 0 1-32 32H480a32 32 0 1 1 0-64h384a32 32 0 0 1 32 32zM896 512a32 32 0 0 1-32 32H480a32 32 0 1 1 0-64h384a32 32 0 0 1 32 32z" p-id="2365" fill="#db7e08"></path></svg></span>
           </div>
       </div>
       <audio :src="songurl" ref="audio" @canplay="ready()" @error="error()" @ended="ended()" @timeupdate="updateTime()"></audio>
   </div>
</template>

<script>
import {mapGetters,mapMutations} from 'vuex'
import { getImgById,getSongById } from "../../api/song";
import {ERR_OK} from '../../assets/js/config'
import ProgressBar from '../../base/progressBar/progressBar.vue'
export default {
    components: {
        ProgressBar
    },
    data(){
        return {
            songurl: null,
            imgurl: "https://p1.music.126.net/-ngeJwmlYTL2NHMc9xZ5gQ==/109951164286699017.jpg",
            songready: false,
            currentTime: 0,
            totalTime: 0
        }
    },
   computed: {
       percent(){
           return this.currentTime / this.totalTime
       },
       ...mapGetters([
           'fullScreen',
           'playlist',
           'playing',
           'mode',
           'currentSong',
           'currentIndex'
       ])
   },
   methods: {
       backtomini(){
           this.tomini(false)
       },
       backtonormal(){
           this.tomini(true)
       },
       _setkey(){
           const key = this.playing? false : true
           this.setPlaying(key)
       },
       _setMode(){
           const mode = (this.mode + 1) % 3
           this.setMode(mode)
       },
       joinSingers(ar){
           if(!ar){
               return "kzer"
           }
           var singersOfsongs = []
           for(let i = 0; i < ar.length; i++){
               singersOfsongs.push(ar[i].name)
           }
           return singersOfsongs.join('/')
       },
       lastsong(){
           if(!this.songready){
               return
           }
           let index = 0;
           if(this.currentIndex == 0){
               index = this.playlist.length - 1
           }else{
               index = this.currentIndex - 1
           }
           if(this.mode == 2){
               index = Math.floor(Math.random() * (this.playlist.length - 1))
           }
           this.setCurrentIndex(index)
           this.songready = false
       },
       nextsong(){
           if(!this.songready){
               return
           }
           let index = this.currentIndex + 1
           if(index == this.playlist.length){
               index = 0
           }
           if(this.mode == 2){
               index = Math.floor(Math.random() * (this.playlist.length - 1))
           }
            this.setCurrentIndex(index)
            this.songready = false
       },
       ended(){
           let index = this.currentIndex + 1
           if(index == this.playlist.length){
               index = 0
           }
           if(this.mode == 2){
               index = Math.floor(Math.random() * (this.playlist.length - 1))
           }else if(this.mode == 1){
               this.$refs.audio.load()
               this.$refs.audio.play()
               return
           }
            this.setCurrentIndex(index)
            this.songready = false
       },
       ready(){
           this,this.songready = true;
       },
       updateTime(e){
           this.currentTime = this.$refs.audio.currentTime
       },
       format(interval){
           interval = interval | 0
           const minute = interval / 60 | 0
           const second = interval % 60
           return `${minute<10?'0'+minute:minute}:${second<10?'0'+second:second}`
       },
       onProgressBarChange(percent){
           this.$refs.audio.currentTime = this.totalTime * percent
           if(!this.playing){
               this._setkey()
           }
       },
       ...mapMutations({
           tomini: "SET_FULLSCREEN",
           setPlaying: "SET_PLAYING",
           setMode: "SET_MODE",
           setCurrentIndex: "SET_CURRENTINDEX"
       })
   },
   watch: {
       currentSong(){
           this.$nextTick(()=>{
               getImgById({
                   ids: this.currentSong.id
               }).then(res=>{
               if(res.code === ERR_OK){
                this.imgurl = res.songs[0].al.picUrl;
                this.totalTime = res.songs[0].dt / 1000
               }
           })
           getSongById({
                   id: this.currentSong.id
               }).then(res=>{
               if(res.code === ERR_OK){
                   let r = res.data[0].url
                   if(r == null){
                       this.ready()
                       this.nextsong()
                       return
                   }
                    this.songurl = r;
                    
               }
           })
           this.$refs.audio.play()
           })
       },
       playing(newplay){
           this.$nextTick(()=>{
               const audio = this.$refs.audio
               newplay? audio.play() : audio.pause()
           })
       },
       songurl(newurl){
           console.log(newurl)
           this.$nextTick(()=>{
            if(newurl && this.playing){
                this.$refs.audio.play()
            }
           })
       }
   }
}
</script>
<style scoped>
.mini-player{
    z-index: 100;
    position: fixed;
    width: 100%;
    height: 80px;
    bottom: 0;
    background-color: rgb(65, 55, 55);
}
.mini-icon{
    display: inline-block;
}

.mini-info{
    position: absolute;
    display: inline-block;
    left: 80px;
    top: 20px;
    overflow: hidden;
}
.mini-key{
    display: inline-block;
    position: absolute;
    right: 80px;
    top: 30px;
}
.mini-list{
    display: inline-block;
    position: absolute;
    right: 30px;
    top: 30px;
    
}
.miniimg{
    border-radius: 50%;
    width: 50px;
    margin-top: 15px;
    margin-left: 20px;
}

.normal-player{
    z-index: 100;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 100%;
    background-color: rgb(61, 57, 57);
    text-align: center;
}
.back{
    position: relative;
    left: -40%;
}

.bottom{
    position: relative;
    top: 80px;
    display: flex;
    width: 262px;
    margin: auto;
}
.playtype,.last,.key,.next,.love{
    margin: 0 10px;
}
.middle{
    position: relative;
    top: 10px;
}
.cd-wrapper{
    margin: auto;
    width: 300px;
    height: 300px;
    border: 18px solid;
    border-radius: 50%;
    overflow: hidden;
    border-color: rgb(35, 35, 36);
}
.background{
    position: absolute;
    z-index: -10;
}
.imgback{
    height: 100%;
    margin-left: -30%;
    filter: blur(20px);
}
.cdimg{
    width: 100%;
    height: 100%;
}
.words{
    height: 80px;
    position: relative;
    top: 30px;
}
.songbar{
    height: 80px;
    position: relative;
    top: 60px;
}

.songname{
    font-size: 18px;
    color: rgb(190, 112, 48);
}
.songinfo{
    font-size: 16px;
    color: rgb(146, 142, 142);
}
</style>